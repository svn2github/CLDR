# This file specifies a set of mappings that are based on NFKC normalization plus case foldings.
# These are all table driven, using a set of rules as listed below.
#
# <source> ; <target> ; <targetFilter> # comment
#
# source
#   a UnicodeSet (like [:Lm:]),
#   a single code point (like 0130), or
#   a code point range (like 2170-217F)
# target
#   a code point, or
#   exclude     the code point maps to itself
#   caseonly    no normalization is done, but case folding is
#   delete      the code point maps to the empty string (is removed)
#   ok          it is ok to use the basic mapping. (This is done to override a previous statement.)
# targetFilter
#   a Unicode set, or
#   missing     meaning no restriction
#
# Commands (determine the characters listed)
#
# @LIST=ALL                - (default) list all characters
# @LIST=SHOW_AGE           - list all characters, show age of new characters
# @LIST=ONLY_OLD           - only list Unicode 5.0 characters
#
# Issues:
#  Currently the code doesn't include a small number of NFC mappings like:
#       1FEF ; 0060 ; # GREEK VARIA => GRAVE ACCENT
#  Other items that I think we should also do are marked with **
# ====================================

# First, the normalization (toNFKC+case) is only applied if both source and resulting characters are all in [[:alphabetic:][:Nd:][:m:]].
# That is, they must all be alphabetic, decimal digits, or marks. This was done because the target string
# was to be a "word" if the source was.

[[:alphabetic:][:Nd:][:m:]-[:Lm:]] ; ok ; [[:alphabetic:][:Nd:][:m:]]

# We **should** probably relax the above, to allow for clients that want to fold other characters.
# However, if a character is "special" (superscript, squared, etc.) we should bracket the result with "space"
# to prevent, for example, 2Â² from matching 22.
# So we should precede by the following statements. They normalize all whitespace, and normalize
# everything else to SP + nfkc(case(nfkc(x))) + SP.
# The special syntax is to remove non-whitespace items that decompose to whitespace, like GRAVE ACCENT
#
#[:assigned:] ; caseonly ; #first, make sure that everything is cased (and NFC).
#[:whitespace:] ; ok ; #then pick up whitespace
#[:^whitespace:] ; bracket ; [:^whitespace:] # then everything else (that doesn't produce whitespace!)

# In addition, we always normalize wide characters, even if not word characters

[:decomposition_type=wide:] ; ok ;

# We **should** do the same for narrow characters

#[:decomposition_type=narrow:] ; ok ;

# Case-only
# **should** be bracketed instead of caseonly.

[:decomposition_type=circle:] ; caseonly ; 
[:decomposition_type=super:] ; caseonly ;
[:decomposition_type=sub:] ; caseonly ;

# Deletions
# These are because a variation selector acts like the previous character is a compatibility variant.

[:Variation_Selector:] ; delete ;

# Detailed changes
# Many of these originally come from the UCA file.

# Sharp S

00DF ; exclude ; # LATIN SMALL LETTER SHARP S => LATIN SMALL LETTER S + LATIN SMALL LETTER S
1E9E ; 00DF ; # LATIN CAPITAL LETTER SHARP S => LATIN SMALL LETTER SHARP S

05F0 ; 05D5 05D5 ; # HEBREW LIGATURE YIDDISH DOUBLE VAV => HEBREW LETTER VAV + HEBREW LETTER VAV
05F1 ; 05D5 05D9 ; # HEBREW LIGATURE YIDDISH VAV YOD => HEBREW LETTER VAV + HEBREW LETTER YOD
05F2 ; 05D9 05D9 ; # HEBREW LIGATURE YIDDISH DOUBLE YOD => HEBREW LETTER YOD + HEBREW LETTER YOD
FB1F ; 05D9 05D9 05B7 ; # HEBREW LIGATURE YIDDISH YOD YOD PATAH => HEBREW LETTER YOD + HEBREW LETTER YOD + HEBREW POINT PATAH

0E33 ; exclude ; # THAI CHARACTER SARA AM => THAI CHARACTER NIKHAHIT + THAI CHARACTER SARA AA

# Fix isolated forms, tatweel

0640 ; delete ; # ARABIC TATWEEL => 
FE73 ; delete ; # ARABIC TAIL FRAGMENT => 

FC5E ; 064C 0651 ; # ARABIC LIGATURE SHADDA WITH DAMMATAN ISOLATED FORM => ARABIC DAMMATAN + ARABIC SHADDA
FC5F ; 064D 0651 ; # ARABIC LIGATURE SHADDA WITH KASRATAN ISOLATED FORM => ARABIC KASRATAN + ARABIC SHADDA
FC60 ; 064E 0651 ; # ARABIC LIGATURE SHADDA WITH FATHA ISOLATED FORM => ARABIC FATHA + ARABIC SHADDA
FC61 ; 064F 0651 ; # ARABIC LIGATURE SHADDA WITH DAMMA ISOLATED FORM => ARABIC DAMMA + ARABIC SHADDA
FC62 ; 0650 0651 ; # ARABIC LIGATURE SHADDA WITH KASRA ISOLATED FORM => ARABIC KASRA + ARABIC SHADDA
FC63 ; 0651 0670 ; # ARABIC LIGATURE SHADDA WITH SUPERSCRIPT ALEF ISOLATED FORM => ARABIC SHADDA + ARABIC LETTER SUPERSCRIPT ALEF
FCF2 ; 064E 0651 ; # ARABIC LIGATURE SHADDA WITH FATHA MEDIAL FORM => ARABIC FATHA + ARABIC SHADDA
FCF3 ; 064F 0651 ; # ARABIC LIGATURE SHADDA WITH DAMMA MEDIAL FORM => ARABIC DAMMA + ARABIC SHADDA
FCF4 ; 0650 0651 ; # ARABIC LIGATURE SHADDA WITH KASRA MEDIAL FORM => ARABIC KASRA + ARABIC SHADDA

FE70 ; 064B ; # ARABIC FATHATAN ISOLATED FORM => ARABIC FATHATAN
FE71 ; 064B ; # ARABIC TATWEEL WITH FATHATAN ABOVE => ARABIC FATHATAN
FE72 ; 064C ; # ARABIC DAMMATAN ISOLATED FORM => ARABIC DAMMATAN
FE74 ; 064D ; # ARABIC KASRATAN ISOLATED FORM => ARABIC KASRATAN
FE76 ; 064E ; # ARABIC FATHA ISOLATED FORM => ARABIC FATHA
FE77 ; 064E ; # ARABIC FATHA MEDIAL FORM => ARABIC FATHA
FE78 ; 064F ; # ARABIC DAMMA ISOLATED FORM => ARABIC DAMMA
FE79 ; 064F ; # ARABIC DAMMA MEDIAL FORM => ARABIC DAMMA
FE7A ; 0650 ; # ARABIC KASRA ISOLATED FORM => ARABIC KASRA
FE7B ; 0650 ; # ARABIC KASRA MEDIAL FORM => ARABIC KASRA
FE7C ; 0651 ; # ARABIC SHADDA ISOLATED FORM => ARABIC SHADDA
FE7D ; 0651 ; # ARABIC SHADDA MEDIAL FORM => ARABIC SHADDA
FE7E ; 0652 ; # ARABIC SUKUN ISOLATED FORM => ARABIC SUKUN
FE7F ; 0652 ; # ARABIC SUKUN MEDIAL FORM => ARABIC SUKUN

#Fix Hangul

[:block=Hangul_Compatibility_Jamo:]; exclude ; # a thorough job would require context dependence

#  point to isolated characters, not combining jamo
FFA0 ; 3164 ; # HALFWIDTH HANGUL FILLER => HANGUL FILLER
FFA1 ; 3131 ; # HALFWIDTH HANGUL LETTER KIYEOK => HANGUL LETTER KIYEOK
FFA2 ; 3132 ; # HALFWIDTH HANGUL LETTER SSANGKIYEOK => HANGUL LETTER SSANGKIYEOK
FFA3 ; 3133 ; # HALFWIDTH HANGUL LETTER KIYEOK-SIOS => HANGUL LETTER KIYEOK-SIOS
FFA4 ; 3134 ; # HALFWIDTH HANGUL LETTER NIEUN => HANGUL LETTER NIEUN
FFA5 ; 3135 ; # HALFWIDTH HANGUL LETTER NIEUN-CIEUC => HANGUL LETTER NIEUN-CIEUC
FFA6 ; 3136 ; # HALFWIDTH HANGUL LETTER NIEUN-HIEUH => HANGUL LETTER NIEUN-HIEUH
FFA7 ; 3137 ; # HALFWIDTH HANGUL LETTER TIKEUT => HANGUL LETTER TIKEUT
FFA8 ; 3138 ; # HALFWIDTH HANGUL LETTER SSANGTIKEUT => HANGUL LETTER SSANGTIKEUT
FFA9 ; 3139 ; # HALFWIDTH HANGUL LETTER RIEUL => HANGUL LETTER RIEUL
FFAA ; 313A ; # HALFWIDTH HANGUL LETTER RIEUL-KIYEOK => HANGUL LETTER RIEUL-KIYEOK
FFAB ; 313B ; # HALFWIDTH HANGUL LETTER RIEUL-MIEUM => HANGUL LETTER RIEUL-MIEUM
FFAC ; 313C ; # HALFWIDTH HANGUL LETTER RIEUL-PIEUP => HANGUL LETTER RIEUL-PIEUP
FFAD ; 313D ; # HALFWIDTH HANGUL LETTER RIEUL-SIOS => HANGUL LETTER RIEUL-SIOS
FFAE ; 313E ; # HALFWIDTH HANGUL LETTER RIEUL-THIEUTH => HANGUL LETTER RIEUL-THIEUTH
FFAF ; 313F ; # HALFWIDTH HANGUL LETTER RIEUL-PHIEUPH => HANGUL LETTER RIEUL-PHIEUPH
FFB0 ; 3140 ; # HALFWIDTH HANGUL LETTER RIEUL-HIEUH => HANGUL LETTER RIEUL-HIEUH
FFB1 ; 3141 ; # HALFWIDTH HANGUL LETTER MIEUM => HANGUL LETTER MIEUM
FFB2 ; 3142 ; # HALFWIDTH HANGUL LETTER PIEUP => HANGUL LETTER PIEUP
FFB3 ; 3143 ; # HALFWIDTH HANGUL LETTER SSANGPIEUP => HANGUL LETTER SSANGPIEUP
FFB4 ; 3144 ; # HALFWIDTH HANGUL LETTER PIEUP-SIOS => HANGUL LETTER PIEUP-SIOS
FFB5 ; 3145 ; # HALFWIDTH HANGUL LETTER SIOS => HANGUL LETTER SIOS
FFB6 ; 3146 ; # HALFWIDTH HANGUL LETTER SSANGSIOS => HANGUL LETTER SSANGSIOS
FFB7 ; 3147 ; # HALFWIDTH HANGUL LETTER IEUNG => HANGUL LETTER IEUNG
FFB8 ; 3148 ; # HALFWIDTH HANGUL LETTER CIEUC => HANGUL LETTER CIEUC
FFB9 ; 3149 ; # HALFWIDTH HANGUL LETTER SSANGCIEUC => HANGUL LETTER SSANGCIEUC
FFBA ; 314A ; # HALFWIDTH HANGUL LETTER CHIEUCH => HANGUL LETTER CHIEUCH
FFBB ; 314B ; # HALFWIDTH HANGUL LETTER KHIEUKH => HANGUL LETTER KHIEUKH
FFBC ; 314C ; # HALFWIDTH HANGUL LETTER THIEUTH => HANGUL LETTER THIEUTH
FFBD ; 314D ; # HALFWIDTH HANGUL LETTER PHIEUPH => HANGUL LETTER PHIEUPH
FFBE ; 314E ; # HALFWIDTH HANGUL LETTER HIEUH => HANGUL LETTER HIEUH
FFC2 ; 314F ; # HALFWIDTH HANGUL LETTER A => HANGUL LETTER A
FFC3 ; 3150 ; # HALFWIDTH HANGUL LETTER AE => HANGUL LETTER AE
FFC4 ; 3151 ; # HALFWIDTH HANGUL LETTER YA => HANGUL LETTER YA
FFC5 ; 3152 ; # HALFWIDTH HANGUL LETTER YAE => HANGUL LETTER YAE
FFC6 ; 3153 ; # HALFWIDTH HANGUL LETTER EO => HANGUL LETTER EO
FFC7 ; 3154 ; # HALFWIDTH HANGUL LETTER E => HANGUL LETTER E
FFCA ; 3155 ; # HALFWIDTH HANGUL LETTER YEO => HANGUL LETTER YEO
FFCB ; 3156 ; # HALFWIDTH HANGUL LETTER YE => HANGUL LETTER YE
FFCC ; 3157 ; # HALFWIDTH HANGUL LETTER O => HANGUL LETTER O
FFCD ; 3158 ; # HALFWIDTH HANGUL LETTER WA => HANGUL LETTER WA
FFCE ; 3159 ; # HALFWIDTH HANGUL LETTER WAE => HANGUL LETTER WAE
FFCF ; 315A ; # HALFWIDTH HANGUL LETTER OE => HANGUL LETTER OE
FFD2 ; 315B ; # HALFWIDTH HANGUL LETTER YO => HANGUL LETTER YO
FFD3 ; 315C ; # HALFWIDTH HANGUL LETTER U => HANGUL LETTER U
FFD4 ; 315D ; # HALFWIDTH HANGUL LETTER WEO => HANGUL LETTER WEO
FFD5 ; 315E ; # HALFWIDTH HANGUL LETTER WE => HANGUL LETTER WE
FFD6 ; 315F ; # HALFWIDTH HANGUL LETTER WI => HANGUL LETTER WI
FFD7 ; 3160 ; # HALFWIDTH HANGUL LETTER YU => HANGUL LETTER YU
FFDA ; 3161 ; # HALFWIDTH HANGUL LETTER EU => HANGUL LETTER EU
FFDB ; 3162 ; # HALFWIDTH HANGUL LETTER YI => HANGUL LETTER YI
FFDC ; 3163 ; # HALFWIDTH HANGUL LETTER I => HANGUL LETTER I

# Special combining cases.
# Normally NFKC maps these to SPACE + accent. Since we disallow that, we at least
# pick up the cases where two characters both map to the same value.
# Some of these are only active if we are doing *all* characters (not just IDs)

0340 ; 0300 ; # COMBINING GRAVE TONE MARK => COMBINING GRAVE ACCENT
0341 ; 0301 ; # COMBINING ACUTE TONE MARK => COMBINING ACUTE ACCENT
0343 ; 0313 ; # COMBINING GREEK KORONIS => COMBINING COMMA ABOVE
0344 ; 0308 0301 ; # COMBINING GREEK DIALYTIKA TONOS => COMBINING DIAERESIS + COMBINING ACUTE ACCENT
FFE3 ; 00AF ; # FULLWIDTH MACRON => MACRON

# ==============================
# IN 2008-05-08 Version

0130 ; 0069 ; # LATIN CAPITAL LETTER I WITH DOT ABOVE => LATIN SMALL LETTER I 

013F ; 006C 00B7 ; # LATIN CAPITAL LETTER L WITH MIDDLE DOT => LATIN SMALL LETTER L + MIDDLE DOT 
0140 ; 006C 00B7 ; # LATIN SMALL LETTER L WITH MIDDLE DOT => LATIN SMALL LETTER L + MIDDLE DOT 

200E ; delete ; # LEFT-TO-RIGHT MARK => 
200F ; delete ; # RIGHT-TO-LEFT MARK => 
202A ; delete ; # LEFT-TO-RIGHT EMBEDDING => 
202B ; delete ; # RIGHT-TO-LEFT EMBEDDING => 
202C ; delete ; # POP DIRECTIONAL FORMATTING => 
202D ; delete ; # LEFT-TO-RIGHT OVERRIDE => 
202E ; delete ; # RIGHT-TO-LEFT OVERRIDE => 

# Note: we **should** exclude all default-ignorables instead of just the above

# [:default_ignorable_code_point:] ; delete ;

# ==============================

# Fix the fact that we aren't normalizing all narrow characters

# Note: we **should** also do the first two

#FF61 ; ok ; # HALFWIDTH IDEOGRAPHIC FULL STOP => IDEOGRAPHIC FULL STOP
#FF65 ; ok ; # HALFWIDTH KATAKANA MIDDLE DOT => KATAKANA MIDDLE DOT

FF70 ; ok ; # HALFWIDTH KATAKANA-HIRAGANA PROLONGED SOUND MARK => KATAKANA-HIRAGANA PROLONGED SOUND MARK
FF9E ; ok ; # HALFWIDTH KATAKANA VOICED SOUND MARK => COMBINING KATAKANA-HIRAGANA VOICED SOUND MARK
FF9F ; ok ; # HALFWIDTH KATAKANA SEMI-VOICED SOUND MARK => COMBINING KATAKANA-HIRAGANA SEMI-VOICED SOUND MARK

# =================================


# Multiletter forms
# ** We should bracket these, instead of excluding.

20A8 ; exclude ; # RUPEE SIGN => LATIN SMALL LETTER R + LATIN SMALL LETTER S
2116 ; exclude ; # NUMERO SIGN => LATIN SMALL LETTER N + LATIN SMALL LETTER O
2121 ; exclude ; # TELEPHONE SIGN => LATIN SMALL LETTER T + LATIN SMALL LETTER E + LATIN SMALL LETTER L
213B ; exclude ; # FACSIMILE SIGN => LATIN SMALL LETTER F + LATIN SMALL LETTER A + LATIN SMALL LETTER X
FDFC ; exclude ; # RIAL SIGN => ARABIC LETTER REH + ARABIC LETTER FARSI YEH + ARABIC LETTER ALEF + ARABIC LETTER LAM
309F ; exclude ; # HIRAGANA DIGRAPH YORI => HIRAGANA LETTER YO + HIRAGANA LETTER RI
30FF ; exclude ; # KATAKANA DIGRAPH KOTO => KATAKANA LETTER KO + KATAKANA LETTER TO

# Telegraph
# ** We should bracket these, instead of excluding.
32C0-33FE ; exclude ; # IDEOGRAPHIC TELEGRAPH SYMBOL FOR JANUARY => DIGIT ONE + CJK UNIFIED IDEOGRAPH-6708 .. IDEOGRAPHIC TELEGRAPH SYMBOL FOR DAY THIRTY-ONE => DIGIT THREE + DIGIT ONE + CJK UNIFIED IDEOGRAPH-65E5

# Radicals
# ** We should go ahead and map these, instead of excluding. No reason to bracket

2E9F-2FD5 ; exclude ; # CJK RADICAL MOTHER => <CJK Ideograph> .. KANGXI RADICAL FLUTE => <CJK Ideograph>

# Roman numerals
# ** We should go ahead and map these, instead of caseonly. No reason to bracket

[:Letter_Number:] ; caseonly ;

# To match 2008-05-08 Version, we have these exceptions.
3038 ; 5341 ; # HANGZHOU NUMERAL TEN => <CJK Ideograph> 
3039 ; 5344 ; # HANGZHOU NUMERAL TWENTY => <CJK Ideograph> 
303A ; 5345 ; # HANGZHOU NUMERAL THIRTY => <CJK Ideograph> 




