<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>XML Collation Specification</title>
<style>
<!--
th           { background-color: #9999CC; border-style: solid; border-width: 1px; padding: 4 }
td           { background-color: #CCCCFF; border-style: solid; border-width: 1px; padding: 4 }
table        { border-style: solid; border-width: 1px }
-->
</style>
</head>

<body style="margin:2em" bgcolor="#F8F8FF">

<h1 align="center">XML Collation Specification</h1>
<p align="center"><i><font size="4">MED, 2002-09-05</font></i></p>
<p>This document defines an XML syntax for exchanging tailoring rules, and
specifying comparison options. It allows any two implementations to exchange a
specification of collation. Using the same specification, the two
implementations will achieve the same results in comparing strings.</p>
<p>&nbsp;The rules are defined by correspondence with the <i>basic</i> <a href="http://oss.software.ibm.com/icu/userguide/Collate_Customization.html">ICU
rule syntax</a> (used in ICU and Java) and/or the ICU parameterizations. You
should be familiar with the UCA and the ICU implementation of it before
continuing with the rest of this document.</p>
<blockquote>
  <p><b>Note: </b>ICU provides a concise format for specifying orderings, based
  on tailorings to the UCA. For example, to specify that k and q follow 'c', one
  can use the rule: &quot;&amp; c &lt; k &lt; q&quot;. The rules also allow
  people to set default general parameter values, such as whether uppercase is
  before lowercase or not.</p>
  <p>Java contains an earlier version of ICU, and has not been updated recently.
  It does not support any of the basic syntax marked with [...], and its default
  table is not the UCA.</p>
  <p><i><b>It is not necessary for ICU to be used in the underlying
  implementation. The features are simply described here in terms of the ICU
  capabilities, since that is easier than duplicating the text. In a final
  version of the specification, the details of the semantics will be moved here.</b></i></p>
</blockquote>
<p>Like the ICU rules, the tailoring syntax is designed to be independent of the
actual weights used in any particular UCA table. That way the same rules can be
applied to UCA versions over time, even if the underlying weights change.</p>
<h3><a name="Document_Structure">Document Structure</a></h3>
<p>The following describes the overall document structure used to specify a
collation in XML.</p>
<p><code>&lt;collation&gt;<br>
&nbsp;&lt;base UCA='3.1.1'&gt;<br>
&nbsp;<i><b>or</b> </i>&lt;base UCA='3.1.1' url=&quot;...&quot;&gt;<br>
&nbsp;<i><b>or</b> </i>&lt;base UCA='3.1.1' xml:lang=&quot;...&quot;
version=&quot;...&quot;&gt;<br>
&nbsp;&lt;settings caseLevel=&quot;on&quot;/&gt;<br>
&nbsp;&lt;rules&gt;<br>
&nbsp; &lt;!-- rules go here --&gt;<br>
&nbsp;&lt;/rules&gt;<br>
&lt;/collation&gt;</code></p>
<blockquote>
  <p><i><b>Note: </b>For version 3.1.1 of the UCA, the version of Unicode must
  also be specified with any versioning information. This has been changed as of
  the last UTC meeting, so that it will no longer be necessary as of UCA 4.0. So
  it is omitted here.</i></p>
</blockquote>
<p>When the url is used in base, then the settings override what is in the base.
The rules are treated as if they were appended to the rules in the URL. When the
xml:lang is used, then the rules in the ICU repository with that version are
specified.</p>
<blockquote>
  <p><b>TBD: add DTD, clarify how versions work.</b></p>
</blockquote>
<h3><a name="Setting_Options">Setting Options</a></h3>
<p>In XML, these are attributes of &lt;settings&gt;. For example, &lt;setting
strength=&quot;secondary&quot;&gt; will only compare strings based on their
primary and secondary weights.</p>
<p>If the attribute is not present, the default (or for the base url's
attribute, if there is one) is used. The default is listed in italics. The
effect of these are defined by reference to the effect of the <a href="http://oss.software.ibm.com/icu/apiref/ucol_8h.html#a69">setAttributes</a>
API (except for variableTop, which corresponds to the <a href="http://oss.software.ibm.com/icu/apiref/classCollator.html#a21">setVariableTop</a>
API). The basic example is given where the setting can also be given with rules
in the basic syntax.</p>
<table>
  <tbody>
    <tr>
      <th>Attribute</th>
      <th>Options</th>
      <th>Basic Example &nbsp;</th>
      <th>XML Example</th>
    </tr>
    <tr>
      <td>alternate</td>
      <td><i>non-ignorable</i><br>
        shifted</td>
      <td><font color="#000000"><code>[alternate non-ignorable]</code></font></td>
      <td><code>alternate=&quot;non-ignorable&quot;</code></td>
    </tr>
    <tr>
      <td>backwards</td>
      <td>on<br>
        <i>off</i></td>
      <td><font color="#000000"><code>[backwards on] &nbsp;</code></font></td>
      <td><code>backwards=&quot;on&quot;</code></td>
    </tr>
    <tr>
      <td>normalization</td>
      <td>on<br>
        off</td>
      <td><font color="#000000"><code>[normalization on]&nbsp;</code></font></td>
      <td><code>normalization=&quot;off&quot;</code></td>
    </tr>
    <tr>
      <td>caseLevel</td>
      <td>on<br>
        off</td>
      <td><font color="#000000"><code>[caseLevel on]</code></font></td>
      <td><code>caseLevel=&quot;off&quot;</code></td>
    </tr>
    <tr>
      <td>caseFirst</td>
      <td>upper<br>
        lower<br>
        off</td>
      <td><font color="#000000"><code>[caseFirst off]</code></font></td>
      <td><code>caseFirst=&quot;off&quot;</code></td>
    </tr>
    <tr>
      <td>hiraganaQ</td>
      <td>on<br>
        off</td>
      <td><code>[hiraganaQ on]</code></td>
      <td><code>hiraganaQuarternary=&quot;on&quot;</code></td>
    </tr>
    <tr>
      <td><font color="#000000">strength</font></td>
      <td>primary (1)<br>
        secondary (2)<br>
        tertiary (3)<br>
        quarternary (4)<br>
        identical (5)</td>
      <td><code>[strength 1]</code></td>
      <td><code>strength=&quot;primary&quot;</code></td>
    </tr>
    <tr>
      <td>variableTop<sup>1</sup></td>
      <td><font color="#000000">at character(s)<br>
        before character(s)<br>
        after character(s)</font></td>
      <td><code>&amp; x = [variable top]<br>
        &amp; [before 1] x &lt; [variable top]<br>
        &amp; x &lt; [variable top]</code></td>
      <td><code>variableTopAfter=&quot;x&quot;</code></td>
    </tr>
  </tbody>
</table>
<blockquote>
  <p><b>Issue:</b> This syntax might limit the characters in variableTop, since
  attributes can't handle all characters. Perhaps this needs to be a separate
  element.</p>
  <ol>
    <li>The default value for variableTop depends on the UCA setting. For
      example, in 3.1.1d1, the value is:<br>
      U+1D7C3 MATHEMATICAL SANS-SERIF BOLD ITALIC PARTIAL DIFFERENTIAL. See
      below for the layout.</li>
  </ol>
</blockquote>
<h2><a name="Rules">Rules</a></h2>
<p>The goal for the rule syntax is to have clearly expressed rules, with a
concise format, that parallels the Basic syntax as much as possible.&nbsp; The
rule syntax uses elements as <i>delimiters</i> rather than <i>containers</i>.
The reason for this is because the tailorings for CJK characters are quite large
(tens of thousands of elements), and the extra overhead of the element
termination would have been considerable. For the same reason, the element names
for primary (level 1), secondary (level 2), tertiary (level 3), and identical
are abbreviated, to be as short as possible. Other elements and attributes do
not occur as frequently, and have longer names.</p>
<blockquote>
  <p><b><i>Note: </i></b>The rules are stated in terms of actions that cause
  characters to change their ordering relative to other characters. This is for
  stability; assigning characters specific weights would not work, since the
  exact weight assignment in UCA (or ISO 14651) is not required for conformance
  -- only the relative ordering of the weights. In addition, stating rules in
  terms of relative order is less sensitive to changes over time in the UCA
  itself.</p>
</blockquote>
<h3><a name="Orderings">Orderings</a></h3>
<p>The following are the normal ordering actions used for the bulk of
characters:</p>
<table>
  <tr>
    <th>Basic Symbol</th>
    <th>Basic Example</th>
    <th>XML Symbol</th>
    <th>XML Example</th>
    <th>Description</th>
  </tr>
  <tr>
    <td align="center"><code>&lt; &nbsp;</code></td>
    <td><code>a &lt; b &nbsp;</code></td>
    <td><code>&lt;p/&gt;</code></td>
    <td><code>a&lt;p/&gt;b</code></td>
    <td>Make 'b' sort after 'a', as a <i>primary</i> (base-character) difference</td>
  </tr>
  <tr>
    <td align="center"><code>&lt;&lt; &nbsp;</code></td>
    <td><code>a &lt;&lt; ä &nbsp;</code></td>
    <td><code>&lt;s/&gt;</code></td>
    <td><code>a&lt;s/&gt;ä</code></td>
    <td>Make 'ä' sort after 'a' as a <i>secondary</i> (accent) difference</td>
  </tr>
  <tr>
    <td align="center"><code>&lt;&lt;&lt; &nbsp;</code></td>
    <td><code>a &lt;&lt;&lt; A &nbsp;</code></td>
    <td><code>&lt;t/&gt;</code></td>
    <td><code>a&lt;t/&gt;A</code></td>
    <td>Make 'A' sort after 'a' as a <i>secondary</i> (accent) difference</td>
  </tr>
  <tr>
    <td align="center"><code>= &nbsp;</code></td>
    <td><code>x = y &nbsp;</code></td>
    <td><code>&lt;i/&gt;</code></td>
    <td><code>v&lt;i/&gt;w</code></td>
    <td>Make 'w' sort <i>identically</i> to 'v'</td>
  </tr>
  <tr>
    <td align="center"><code>&amp; &nbsp;</code></td>
    <td><code>&amp; Z &nbsp;</code></td>
    <td><code>&lt;reset/&gt;</code></td>
    <td><code>&lt;reset/&gt;Z</code></td>
    <td>Don't change the ordering of Z, but place subsequent characters relative
      to it.</td>
  </tr>
</table>
<h3><a name="Escaping_Characters">Escaping Characters</a></h3>
<p>Unfortunately, XML does not have the capability to contain all Unicode code
points. Due to this, extra syntax is required to represent those code points
that cannot be otherwise represented. This corresponds to the quoting mechanism
used in the basic syntax. This also must be used where spaces are significant
(otherwise they are stripped).</p>
<table>
  <tr>
    <th>Basic Example</th>
    <th>XML Example</th>
  </tr>
  <tr>
    <td><code>'\u0000'</code></td>
    <td><code>&lt;cp hex=&quot;0&quot;&gt;</code></td>
  </tr>
</table>
<h3><a name="Contractions">Contractions</a></h3>
<p>To sort a sequence as a single item (contraction), just use the sequence,
e.g.</p>
<table>
  <tr>
    <th>BASIC Example</th>
    <th>XML Example</th>
    <th>Description</th>
  </tr>
  <tr>
    <td><code>&amp; k &lt; ch</code></td>
    <td><code>&lt;reset/&gt;k&lt;p/&gt;ch</code></td>
    <td>Make the sequence 'ch' sort after 'k', as a primary (base-character)
      difference</td>
  </tr>
</table>
<h3><a name="Expansions">Expansions</a></h3>
<p>There are two ways to handle expansions (where a character sorts as a
sequence) with both the basic syntax and the XML syntax. The first method is to
reset to the sequence of characters. The second is to use the extension
sequence. Both are equivalent in practice (unless the reset sequence happens to
be a contraction).</p>
<table>
  <tr>
    <th>Basic</th>
    <th>XML</th>
    <th>Description</th>
  </tr>
  <tr>
    <td><code>&amp; ch &lt; k</code></td>
    <td><code>&lt;reset/&gt;ch&lt;p/&gt;k</code></td>
    <td>Make 'k' sort after the sequence 'ch'; thus 'k' will behave as if it
      expands to a character after 'c' followed by an 'h'. (unless 'ch' is
      defined beforehand as a contraction).</td>
  </tr>
  <tr>
    <td><code>&amp;&nbsp;c&nbsp;&lt;&nbsp;k&nbsp;/&nbsp;h</code></td>
    <td><code>&lt;reset/&gt;c&lt;p/&gt;k&lt;extend/&gt;h</code></td>
    <td>Make 'k' sort after the sequence 'ch'; thus 'k' will behave as if it
      expands to a character after 'c' followed by an 'h'.</td>
  </tr>
</table>
<p>In the basic syntax, you can reset <i>variable top</i> by treating it as if
it were a character. In XML, it is always an option on settings.</p>
<table>
  <tr>
    <th>Item</th>
    <th>Basic Example &nbsp;</th>
    <th>XML</th>
  </tr>
  <tr>
    <td>variable top &nbsp;</td>
    <td><code>&amp; X &lt; [variable top] &nbsp;</code></td>
    <td><code>&lt;setting variableTopAfter=&quot;X&quot;/&gt;</code></td>
  </tr>
</table>
<h3><a name="Context_Before">Context Before</a></h3>
<p>The context before a character can affect how it is ordered, such as in
Japanese. This could be expressed with a combination of contractions and
expansions, but is faster using a context. (The actual weights produced are
different, but the resulting string comparisons are the same.)</p>
<table>
  <tr>
    <th>Basic</th>
    <th>XML</th>
  </tr>
  <tr>
    <td><code>&amp;[before 3] &#12449;<br>
      &lt;&lt;&lt; &#12449;|&#12540;<br>
      = &#65383; |&#12540;<br>
      = &#12353;|&#12540;</code></td>
    <td><code>&lt;reset before=&quot;tertiary&quot;/&gt;&#12449;<br>
      &lt;s&gt;&#12449;&lt;context/&gt;&#12540;<br>
      &lt;eq&gt;&#65383;&lt;context/&gt;&#12540;<br>
      &lt;eq&gt;&#12353;&lt;context/&gt;&#12540;</code></td>
  </tr>
</table>
<h3><a name="Placing_Characters_Before_Others">Placing Characters Before Others</a></h3>
<p>There are certain circumstances where characters need to be placed before a
given character, rather than after. This is the case with Pinyin, for example,
where certain accented letters are positioned before the base letter. That is
accomplished with the following syntax.</p>
<table>
  <tbody>
    <tr>
      <th>Item</th>
      <th>Options</th>
      <th>Basic Example &nbsp;</th>
      <th>XML Example</th>
    </tr>
    <tr>
      <td>before&nbsp;</td>
      <td>primary<br>
        secondary<br>
        tertiary<br>
        identical</td>
      <td><code>&amp; [before 1] a &lt;&lt; à</code></td>
      <td><code>&lt;reset before=&quot;primary&quot;/&gt;a&lt;s/&gt;à</code></td>
    </tr>
  </tbody>
</table>
<h3><a name="Logical_Reset_Positions">Logical Reset Positions</a></h3>
<p>The UCA has the following overall structure for weights, going from low to
high.</p>
<table>
  <tr>
    <th valign="top" align="center" bgcolor="#CCCCFF">Name</th>
    <th valign="top" align="center" bgcolor="#CCCCFF">Description</th>
    <th valign="top" align="center" bgcolor="#CCCCFF">UCA Examples</th>
  </tr>
  <tr>
    <td>first&nbsp;tertiary&nbsp;ignorable<br>
      ...<br>
      last&nbsp;tertiary&nbsp;ignorable</td>
    <td>p, s, t = ignore</td>
    <td>Control Codes<br>
      Format Characters<br>
      Hebrew Points<br>
      Tibetan Signs<br>
      ...</td>
  </tr>
  <tr>
    <td>first&nbsp;secondary&nbsp;ignorable<br>
      ...<br>
      last&nbsp;secondary&nbsp;ignorable</td>
    <td>p, s = ignore</td>
    <td>None in UCA</td>
  </tr>
  <tr>
    <td>first&nbsp;primary&nbsp;ignorable<br>
      ...<br>
      last&nbsp;primary&nbsp;ignorable</td>
    <td>p = ignore</td>
    <td>Most combining marks</td>
  </tr>
  <tr>
    <td>first&nbsp;variable<br>
      ...<br>
      last&nbsp;variable</td>
    <td><i><b>if</b> alternate = non-ignorable<br>
      </i>p != ignore,<br>
      <i><b>if</b> alternate = shifted</i><br>
      p, s, t = ignore</td>
    <td>Whitespace,<br>
      Punctuation,<br>
      Symbols</td>
  </tr>
  <tr>
    <td>first&nbsp;non-ignorable<br>
      ...<br>
      last&nbsp;non-ignorable</td>
    <td>p != ignore</td>
    <td>Small number of exceptional symbols<br>
      [e.g. U+02D0 MODIFIER LETTER TRIANGULAR COLON]<br>
      Numbers<br>
      Latin<br>
      Greek<br>
      ...</td>
  </tr>
  <tr>
    <td><i>implicits</i></td>
    <td>p != ignore, assigned automatically</td>
    <td>CJK, CJK compatibility (those that are not decomposed)<br>
      CJK Extension A, B<br>
      Unassigned</td>
  </tr>
  <tr>
    <td>first&nbsp;trailing<br>
      ...<br>
      last&nbsp;trailing</td>
    <td>p != ignore,<br>
      used for trailing syllable components</td>
    <td>Jamo Trailing<br>
      Jamo Leading</td>
  </tr>
</table>
<p>Each of the above Names (except <i>implicits</i>) can be used with a reset to
position characters after that logical position. That allows characters to be
ordered before or after a <i>logical</i> position rather than a specific
character.</p>
<blockquote>
  <p><b><i>Note: </i></b>The reason for this is so that tailorings can be more
  stable. A future version of the UCA might add characters at any point in the
  above list. Suppose that you set character X to be after Y. It could be that
  you want X to come after Y, no matter what future characters are added; or it
  could be that you just want Y to come after a given logical position, e.g.
  after the last primary ignorable.</p>
</blockquote>
<p>Here is an example of the syntax:</p>
<table>
  <tr>
    <th>Basic</th>
    <th>XML</th>
  </tr>
  <tr>
    <td><code>&amp; [first tertiary ignorable] &lt;&lt; à&nbsp;</code></td>
    <td><code>&lt;reset/&gt;&lt;position at=&quot;first tertiary
      ignorable&quot;/&gt;&lt;s/&gt;à</code></td>
  </tr>
</table>
<p>For example, to make a character be a secondary ignorable, one can make it be
immediately after (at a secondary level) a specific character (like a combining
dieresis), or one can make it be immediately after the last secondary ignorable.</p>

</body>

</html>
